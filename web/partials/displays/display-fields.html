<div class="madero-style fields-container">
  <div class="row">

    <div class="col-sm-12 col-md-8 pb-2 pb-lg-0">
      <stretchy-input class="mb-0 mr-auto" ng-model="display.name"></stretchy-input> 
    </div>

    <div class="col-sm-12 col-md-4 pl-lg-0">
      <div class="pull-right">
        <label class="mr-2">Media Player Actions:</label>
        <div class="btn-group" dropdown>
          <button id="displayActionsButton" type="button" dropdown-toggle class="form-control btn-select btn-schedule-selector btn-toolbar flex-row">
            <div class="row-entry">
              <span class="text-gray mr-auto">Choose an action</span>
              <span class="text-gray pl-2"><i class="fa fa-sort"></i></span>
            </div>
          </button>
          <div class="dropdown-menu playlist-menu" role="menu">
            <ul>
              <li>
                <button type="button" class="btn-dropdown u_clickable" ng-disabled="!display.playerVersion" ng-click="playerActionsFactory.confirm(display.id, display.name, 'restart')" require-role="da">
                  <span translate>displays-app.fields.controls.restart.name</span>
                </button>
              </li>
              <li>
                <button type="button" class="btn-dropdown u_clickable" ng-disabled="!display.playerVersion || !canReboot(display)" ng-click="playerActionsFactory.confirm(display.id, display.name, 'reboot')" require-role="da">
                  <span translate>displays-app.fields.controls.reboot.name</span>
                </button>
              </li>
              <li>
                <a id="installPlayer" class="u_clickable" ng-click="factory.addDisplayModal(display)">
                  <span translate>displays-app.fields.controls.install</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
<!-- DISPLAY ERRORS AND ALERTS -->

<div ng-show="playerActionsFactory.controlsError" class="madero-style alert alert-danger u_margin-md-top" role="alert">
  <strong translate>displays-app.fields.controls.error</strong> {{playerActionsFactory.controlsError}}
</div> 

<div class="fields-preview-panels display-fields-body mt-4 madero-style">
  <div class="fields-container">

    <!-- DISPLAY DETAILS -->
    <div class="u_padding-20-vertical">
      <label class="mb-0 mr-auto" translate>displays-app.displayDetails</label>
    </div>

    <div class="scrollable-list border-container">

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0">License Display?</label>

          <span class="mr-auto" ng-show="updatingRPP">
            <span translate>displays-app.details.rpp-loading</span> <i class="fa fa-spinner fa-spin fa-fw"></i>
          </span>

          <div class="btn-group btn-group-justified" ng-hide="updatingRPP">
            <button id="toggleLicenseOn" type="button" class="btn" ng-click="toggleProAuthorized()"  ng-disabled="updatingRPP || !isProToggleEnabled()"
              ng-class="{'btn-toggle-blue-off' : !display.playerProAuthorized, 'btn-toggle-blue-on' : display.playerProAuthorized}">
              Yes
              <streamline-icon name="checkmark" ng-show="display.playerProAuthorized"></streamline-icon>
            </button>
            <button id="toggleLicenseOff" type="button" class="btn" ng-click="toggleProAuthorized()" ng-disabled="updatingRPP || !isProToggleEnabled()"
              ng-class="{'btn-toggle-blue-off' : display.playerProAuthorized, 'btn-toggle-blue-on' : !display.playerProAuthorized}">
              No
              <streamline-icon name="checkmark" ng-show="!display.playerProAuthorized"></streamline-icon>
            </button>
          </div>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.id</label>
          <span class="mr-auto">
            {{display.id}}
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.resolution</label>
          <span class="mr-auto">
            <span ng-show="display.playerVersion">{{display.width | resolution: display.height}}</span>
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.lastConnection</label>
          <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
            License Required
          </span>
          <span class="mr-auto" ng-if="!factory.showLicenseRequired(display)">
            {{display.lastConnectionTime | date:'d-MMM-yyyy h:mm a'}}
          </span>
        </div>
      </div>

      <!-- SCREENSHOT  -->
      <screenshot></screenshot>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.status</label>
          <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
            License Required
          </span>
          <span class="mr-auto" ng-if="!factory.showLicenseRequired(display)">
            <i ng-if="displayService.statusLoading" class="fa fa-spinner fa-spin fa-fw"></i>
            <span class="text-danger" ng-show="!displayService.statusLoading && (display | status) === 'offline'">Offline</span>
            <span class="text-success" ng-show="!displayService.statusLoading && (display | status) === 'online'">Online</span>
            <a id="notActivatedLink" class="u_icon-hover u_clickable" ng-show="!displayService.statusLoading && (display | status) === 'notinstalled'" ng-click="factory.addDisplayModal(display)">
              {{ 'displays-app.list.status.notActivated' | translate }}
            </a>
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.rpp.monitoring</label>
          <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
            License Required
          </span>

          <div class="btn-group btn-group-justified" ng-if="!factory.showLicenseRequired(display)">
            <button id="monitoringOn" type="button" class="btn" ng-click="display.monitoringEnabled = !display.monitoringEnabled" ng-disabled="factory.showLicenseRequired(display)"
              ng-class="{'btn-toggle-blue-off' : !display.monitoringEnabled, 'btn-toggle-blue-on' : display.monitoringEnabled}">
              Yes
              <streamline-icon name="checkmark" ng-show="display.monitoringEnabled"></streamline-icon>
            </button>
            <button id="monitoringOff" type="button" class="btn" ng-click="display.monitoringEnabled = !display.monitoringEnabled" ng-disabled="factory.showLicenseRequired(display)"
              ng-class="{'btn-toggle-blue-off' : display.monitoringEnabled, 'btn-toggle-blue-on' : !display.monitoringEnabled}">
              No
              <streamline-icon name="checkmark" ng-show="!display.monitoringEnabled"></streamline-icon>
            </button>
          </div>
        </div>
      </div>

      <div class="list-group-item" ng-show="!factory.showLicenseRequired(display) && display.monitoringEnabled">
        <timeline-basic-textbox timeline-string="display.monitoringSchedule" ng-disabled="!display.monitoringEnabled" />
      </div>

      <div class="list-group-item" ng-show="!factory.showLicenseRequired(display) && display.monitoringEnabled">
        <div class="flex-row form-group mb-0">
          <div class="row-entry">
            <label class="control-label pull-left mb-0" translate>displays-app.fields.player.rpp.email-recipients</label>
            <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
              License Required
            </span>
          </div>
        </div>

        <div class="mt-2" ng-if="!factory.showLicenseRequired(display)">Separate multiple recipients by a comma.</div>
        <div class="mt-3" ng-class="{ 'has-error': !displayDetails.monitoringEmails.$valid }" ng-if="!factory.showLicenseRequired(display)">
          <emails-field name="monitoringEmails" ng-model="display.monitoringEmails"></emails-field>
          <p class="help-block validation-error-message-email" ng-show="!displayDetails.monitoringEmails.$valid" translate>
            displays-app.fields.player.rpp.invalid-email
          </p>
        </div>
      </div>

      <div class="list-group-item">
        <div class="flex-row form-group mb-0">
          <div class="row-entry">
            <label class="control-label pull-left mb-0">Reboot Media Player Daily At</label>
            <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
              License Required
            </span>

            <div class="btn-group-checkbox" ng-if="!factory.showLicenseRequired(display)">
              <input type="checkbox" id="restartEnabled" name="restartEnabled" ng-model="display.restartEnabled" ng-disabled="factory.showLicenseRequired(display)">

              <div class="btn-group btn-group-justified">
                <button id="restartOn" type="button" class="btn"
                  ng-class="{'btn-toggle-blue-off' : !display.restartEnabled, 'btn-toggle-blue-on' : display.restartEnabled}">
                  Yes
                  <streamline-icon name="checkmark" ng-show="display.restartEnabled"></streamline-icon>
                </button>
                <button id="restartOff" type="button" class="btn"
                  ng-class="{'btn-toggle-blue-off' : display.restartEnabled, 'btn-toggle-blue-on' : !display.restartEnabled}">
                  No
                  <streamline-icon name="checkmark" ng-show="!display.restartEnabled"></streamline-icon>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div ng-show="!factory.showLicenseRequired(display) && display.restartEnabled" class="input-group rise-date-picker radio-nested-input-group mt-3">
          <input type="text"
                 class="form-control"
                 readonly="true"
                 id="restartTime"
                 name="restartTime"
                 ng-model="display.restartTime"
                 ng-click="openTimePicker($event, 'restartTimePickerOpen')"
                 time-picker-popup
                 is-open="restartTimePickerOpen"
          />
          <span class="input-group-btn">
            <button type="button" id="restartTimePickerButton" class="btn btn-primary" ng-click="openTimePicker($event, 'restartTimePickerOpen')">
              <streamline-icon name="clock"></streamline-icon>
            </button>
          </span>
        </div>
      </div>

      <div class="list-group-item" ng-if="!playerProFactory.isCROSLegacy(display) && !playerProFactory.isChromeOSPlayer(display)">
        <div class="flex-row form-group mb-0">
          <div class="row-entry">
            <label class="control-label pull-left mb-0" translate>displays-app.fields.player.displayControl.label</label>
            <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
              License Required
            </span>

            <span class="mr-auto" ng-if="!factory.showLicenseRequired(display) && playerProFactory.isDisplayControlCompatiblePlayer(display)">
              <a class="u_clickable" ng-click="playerProFactory.openConfigureDisplayControl(display)" require-role="da" translate>
                Edit
              </a>
            </span>
          </div>
        </div>

        <div class="mt-2" ng-show="!factory.showLicenseRequired(display) && playerProFactory.isDisplayControlCompatiblePlayer(display)">
          <span translate>displays-app.fields.player.displayControl.description</span>
        </div>
        <div class="text-danger mt-2" ng-show="!factory.showLicenseRequired(display) && !playerProFactory.isDisplayControlCompatiblePlayer(display)">
          <span translate>displays-app.fields.player.displayControl.unsupported</span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0" ng-show="(display.playerVersion || display.onlineStatus === 'online') && (playerProFactory.isCROSLegacy(display) || playerProFactory.isChromeOSPlayer(display))">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.orientation.name</label>
          <select class="form-control mr-auto w-auto" ng-model="display.orientation" integer-parser>
            <option value="0" translate>displays-app.fields.player.orientation.0</option>
            <option value="90" translate>displays-app.fields.player.orientation.90</option>
            <option value="180" translate>displays-app.fields.player.orientation.180</option>
            <option value="270" translate>displays-app.fields.player.orientation.270</option>
          </select>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.address.useCompany</label>

          <div class="btn-group-checkbox">
            <input type="checkbox" id="useCompanyAddress" name="useCompanyAddress" ng-model="display.useCompanyAddress" ng-disabled="factory.showLicenseRequired(display)">
            <div class="btn-group btn-group-justified">
              <button id="useAddressOn" type="button" class="btn" ng-disabled="factory.showLicenseRequired(display)"
                ng-class="{'btn-toggle-blue-off' : !display.useCompanyAddress, 'btn-toggle-blue-on' : display.useCompanyAddress}">
                Yes
                <streamline-icon name="checkmark" ng-show="display.useCompanyAddress"></streamline-icon>
              </button>
              <button id="useAddressOff" type="button" class="btn" ng-disabled="factory.showLicenseRequired(display)"
                ng-class="{'btn-toggle-blue-off' : display.useCompanyAddress, 'btn-toggle-blue-on' : !display.useCompanyAddress}">
                No
                <streamline-icon name="checkmark" ng-show="!display.useCompanyAddress"></streamline-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div ng-hide="display.useCompanyAddress" class="list-group-item address-fields">
        <div class="form-group">
          <label class="control-label" translate>displays-app.fields.address.description</label>
          <input type="text" class="form-control" ng-model="display.addressDescription">
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="control-label" translate>displays-app.fields.address.street</label>
              <input type="text" class="form-control" ng-model="display.street" name="street">
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="control-label" translate>displays-app.fields.address.unit</label>
              <input type="text" class="form-control" ng-model="display.unit" name="unit">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="control-label" translate>displays-app.fields.address.city</label>
              <input type="text" class="form-control" ng-model="display.city" name="city">
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="control-label" translate>displays-app.fields.address.country.name</label>
              <select class="form-control" ng-model="display.country" name="country" ng-options="c.code as c.name for c in countries" empty-select-parser>
                <option value="" ng-show="false" translate>displays-app.fields.address.country.placeholder</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="control-label" translate>displays-app.fields.address.province.name</label>
              <input type="text" class="form-control" ng-model="display.province" name="province" ng-if="display.country != 'US' && display.country != 'CA'" />
              <select class="form-control selectpicker" ng-model="display.province" name="province" ng-options="c[1] as c[0] for c in regionsCA" ng-if="display.country == 'CA'" empty-select-parser>
                <option value="" ng-show="false" translate>displays-app.fields.address.province.provincePlaceholder</option>
              </select>
              <select class="form-control selectpicker" ng-model="display.province" name="province" ng-options="c[1] as c[0] for c in regionsUS" ng-if="display.country == 'US'" empty-select-parser>
                <option value="" ng-show="false" translate>displays-app.fields.address.province.statePlaceholder</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="control-label" translate>displays-app.fields.address.postalCode</label>
              <input type="text" class="form-control" ng-model="display.postalCode" name="postalCode">
            </div>
          </div>
        </div>

        <div class="form-group mb-0">
          <label class="control-label" translate>displays-app.fields.address.timezone.name</label>
          <select class="form-control" ng-model="display.timeZoneOffset" integer-parser>
            <option value="" ng-show="false" translate>displays-app.fields.address.timezone.placeholder</option>
            <option value="{{c[1]}}" ng-repeat="c in timezones">{{c[0]}}</option>
          </select>
        </div>

      </div><!--display address-->

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.ipAddress</label>
          <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
            License Required
          </span>
          <span class="mr-auto" ng-if="!factory.showLicenseRequired(display)">
            {{display.playerLocalIpAddress}}
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0" ng-show="display.macAddress">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.macAddress</label>
          <span class="mr-auto" ng-if="factory.showLicenseRequired(display)">
            License Required
          </span>
          <span class="mr-auto" ng-if="!factory.showLicenseRequired(display)">
            {{display.macAddress}}
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.operatingSystem</label>
          <span class="mr-auto">
            {{display.os}}
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0">
        <div class="row-entry">
          <label class="control-label pull-left mb-0 aligner-item--top" translate>displays-app.fields.player.playerVersion</label>
          <span class="mr-auto">
            <div ng-show="display.playerName">{{display.playerName}}</div>
            <div ng-show="display.playerVersion">{{display.playerVersion}}</div>
            <div ng-show="display.playerVersion && playerProFactory.isOutdatedPlayer(display)" translate>
              displays-app.fields.player.version.notCurrent
            </div>
            <div ng-show="display.playerVersion && playerProFactory.isUnsupportedPlayer(display)">
              <span class="text-danger" translate>displays-app.fields.player.version.unsupported</span>
            </div>
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0" ng-show="display.viewerVersion">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.viewerVersion</label>
          <span class="mr-auto">
            {{display.viewerVersion}}
          </span>
        </div>
      </div>
      <div class="list-group-item flex-row form-group mb-0" ng-show="display.browserVersion">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.browserVersion</label>
          <span class="mr-auto">
            {{(display.browserName ? display.browserName + " " : "") + (display.browserVersion ? display.browserVersion : "")}}
          </span>
        </div>
      </div>

      <div class="list-group-item flex-row form-group mb-0" ng-show="display.serialNumber">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.serialNumber</label>
          <span class="mr-auto">
            {{display.serialNumber}}
          </span>
        </div>
      </div>
      <div class="list-group-item flex-row form-group mb-0" ng-show="display.cpu">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.cpu</label>
          <span class="mr-auto">
            {{display.cpu}}
          </span>
        </div>
      </div>
      <div class="list-group-item flex-row form-group mb-0" ng-show="display.hostName">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.hostName</label>
          <span class="mr-auto">
            {{display.hostName}}
          </span>
        </div>
      </div>
      <div class="list-group-item flex-row form-group mb-0" ng-show="display.productName">
        <div class="row-entry">
          <label class="control-label pull-left mb-0" translate>displays-app.fields.player.productName</label>
          <span class="mr-auto">
            {{display.productName}}
          </span>
        </div>
      </div>

    </div>
  </div>

  <!-- TODO: Remove madero-style once it's global for the page -->
  <div class="preview-container" ng-show="selectedSchedule">
    <div class="row border-bottom u_padding-20-vertical mx-0 mb-4">
      <div class="col-sm-12 px-0 form-inline">
        <preview-selector ng-model="selectedSchedule" additional-class="mr-auto mb-0"></preview-selector>

        <span class="pull-right button-toolbar">
          <a id="viewSchedule" type="button" class="btn btn-default btn-toolbar" ui-sref="apps.schedules.details({ scheduleId: selectedSchedule.id, cid: selectedSchedule.companyId })">Edit Schedule</a>
          <ng-show ng-show="tooltipKey">
            <button id="shareButton" type="button" class="btn btn-default btn-toolbar" 
            tooltip-overlay tooltip-template="'partials/schedules/share-schedule-tooltip.html'" tooltip-placement="bottom" tooltip-class="madero-style tooltip-guide tooltip-share-guide">
              Share
            </button>
          </ng-show>
          <share-schedule-button schedule="selectedSchedule" button-class="btn-default btn-toolbar" ng-hide="tooltipKey"></share-schedule-button>
        </span>

      </div>
    </div>

    <div class="preview-embed">
      <iframe frameborder="0" ng-src="{{getEmbedUrl(selectedSchedule.id)}}">
      </iframe>
    </div>
  </div>

  <div class="preview-container" ng-hide="selectedSchedule">
    <label class="u_padding-20-vertical mb-0">Schedule:</label>

    <div class="border-container empty-preview text-center">
      <preview-selector ng-model="selectedSchedule" label="Nothing is currently showing on your display."></preview-selector>
    </div>
  </div>
</div>
