<div class="madero-style">
  <weekly-templates></weekly-templates>

  <div class="app-header mb-5">
    <!-- App Title -->
    <div class="app-header-title">
      <h1 class="m-0" id="title">Displays</h1>
      <div>
        <span ng-show="playerLicenseFactory.hasProfessionalLicenses()">
          {{ playerLicenseFactory.getUsedLicenseString() }}
        </span>
      </div>
    </div>
  </div>

  <div ng-show="displays.apiError" class="madero-style alert alert-danger u_margin-md-top" role="alert">
    <strong>{{displays.errorMessage}}</strong>
    {{displays.apiError}}
  </div> 

  <div id="errorBox" ng-show="displayStatusFactory.apiError" class="madero-style alert alert-danger u_margin-md-top" role="alert">
    <strong>{{displayStatusFactory.errorMessage}}</strong>
    {{displayStatusFactory.apiError}}
  </div> 

  <div class="flex-row">
    <search-filter class="w-100" filter-config="filterConfig" search="search" do-search="displays.doSearch" icon-set="madero"></search-filter>
    <div class="ml-3" require-role="da">
      <a id="displayAddButton" class="btn btn-primary btn-toolbar-wide" ui-sref="apps.displays.add" translate>
        displays-app.actions.new
      </a>
    </div>
  </div>

  <div class="madero-style alert alert-warning u_margin-md-top" ng-show="search.query">
    <strong translate>displays-app.list.searchNotification</strong>
  </div>

  <div class="scrollable-list border-container u_margin-md-top u_margin-md-bottom"
    scrolling-list="displays.load()" rv-spinner rv-spinner-key="displays-list-loader" rv-spinner-start-active="1">

    <table id="displaysListTable" class="table">
      <thead class="table-header">
        <tr class="table-header__row">
          <th class="table-header__cell col-sm-4 u_clickable" id="tableHeaderName" ng-click="displays.sortBy('name')">
            {{ 'displays-app.list.heading.name' | translate }}
            <i ng-if="search.sortBy === 'name'" class="fa" ng-class="{false: 'fa-caret-up', true: 'fa-caret-down'}[search.reverse]"></i>
          </th>
          <th class="table-header__cell col-sm-1" translate>
            Licensed
          </th>
          <th id="tableHeaderStatus" class="table-header__cell col-sm-1" translate>
            displays-app.list.heading.status
          </th>
          <th id="tableHeaderLastConnection" class="table-header__cell col-sm-2 hidden-xs hidden-sm" translate>
            displays-app.list.heading.lastConnection
          </th>
          <th class="table-header__cell col-sm-3 hidden-xs" translate>
            displays-app.list.heading.schedule
          </th>
        </tr>
      </thead>
      <tbody class="table-body">
        <tr class="table-body__row" ng-class="{ 'bg-warning' : selectedCompayId !== display.companyId }" ng-repeat="display in displays.items.list">
          <td class="table-body__cell">
            <a class="madero-link u_ellipsis-lg" ui-sref="apps.displays.change({displayId: display.id, companyId: display.companyId})">
              <strong>{{display.name}}</strong>
            </a>
          </td>
          <td class="table-body__cell">
            <div ng-show="getDisplayType(display) === 'professional'">
              Yes
            </div>
            <div ng-show="getDisplayType(display) === 'standard'">
              No
            </div>
          </td>
          <td class="table-body__cell display-status">
            <!-- Not Licensed and Installed -->
            <span ng-if="displayFactory.showLicenseRequired(display) && !playerNotInstalled(display)">
              License Required
            </span>
            <!-- Licensed and Loading Status -->
            <i ng-if="displayService.statusLoading && !displayFactory.showLicenseRequired(display)" class="fa fa-spinner fa-spin fa-fw"></i>
            <!-- Licensed and Offline -->
            <span class="text-danger" ng-if="!displayService.statusLoading && !displayFactory.showLicenseRequired(display) && playerOffline(display)">
              Offline
            </span>
            <!-- Licensed and Online -->
            <span class="text-success" ng-if="!displayService.statusLoading && !displayFactory.showLicenseRequired(display) && playerOnline(display)">
              Online
            </span>
            <!-- Not Installed and finished Loading -->
            <span ng-if="!displayService.statusLoading && playerNotInstalled(display)">
              {{ 'displays-app.list.status.notActivated' | translate }}
            </span>
          </td>
          <td class="table-body__cell u_nowrap hidden-xs hidden-sm">
            <span ng-if="displayFactory.showLicenseRequired(display)">
              License Required
            </span>
            <span ng-if="!displayFactory.showLicenseRequired(display)">
              {{display.lastConnectionTime | date:'d-MMM-yyyy h:mm a'}}
            </span>
          </td>
          <td class="table-body__cell hidden-xs display-schedule">
            <a class="madero-link u_ellipsis-md u_icon-hover schedule-view" ng-if="displayService.hasSchedule(display)" ui-sref="apps.schedules.details({ scheduleId: display.scheduleId, cid: display.companyId })" target="_blank">
              {{display.scheduleName}}<i class="fa fa-external-link icon-sm-right"></i>
            </a>
            <span ng-if="!playerNotInstalled(display) && !displayService.hasSchedule(display)">
              No Schedule Selected
            </span>
          </td>
        </tr>
        <!-- If no displays available -->
        <tr ng-show="displays.items.list.length === 0 && !search.query">
          <td colspan="6" class="text-center"><span translate>displays-app.list.empty</span></td>
        </tr>
        <!-- If no search results -->
        <tr ng-show="displays.items.list.length === 0 && search.query">
          <td colspan="4" class="text-center"><span translate>displays-app.list.no-results</span></td>
        </tr>

      </tbody>
    </table>

  </div>

</div>
