<div class="madero-style">
  <div class="app-header u_padding-20-vertical mb-5 border-bottom">
    <!-- App Title -->
    <h1 class="app-header-title">Add Display Licenses</h1>
  </div>

  <div rv-spinner rv-spinner-key="purchase-licenses-loader" rv-spinner-start-active="1"></div>

  <div class="checkout-centered-panel">
    <div class="checkout-gray-panel">
      <h4 class="u_margin-md-bottom mt-0">Subscription Details</h4>

      <div id="errorBox" class="madero-style alert alert-danger u_margin-md-top" role="alert" ng-show="purchase.estimate.estimateError">
        <strong>Tax Estimate Error</strong> {{purchase.estimate.estimateError}}
        <a aria-label="Retry Estimate" class="madero-link u_clickable" ng-click="factory.getEstimate()">Retry</a>
      </div>

      <p ng-show="isSubcompanySelected">
        <b>Purchasing for: {{selectedCompany.name}}</b><br>
        {{selectedCompany.id}}
      </p>

      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label for="displayCount" class="control-label">Number of display licenses you want to add:</label>
            <input class="display-count-input mt-3 pull-right" type="number" name="displayCount" ng-model="factory.purchase.displayCount" min="1" ng-pattern="/^[0-9]+$/" required ng-change="factory.getEstimate()"/>
          </div>
        </div>
      </div>

      <div class="border-bottom py-4 mb-4">
        <p class="mb-0">
          <span>Total number of display licenses for this subscription:</span>
          <span class="pull-right">
            {{currentPlan.playerProTotalLicenseCount + factory.purchase.displayCount}}
          </span>
        </p>
      </div>

      <p class="mb-4" ng-show="!addCoupon && !purchase.couponCode">
        &nbsp;
        <span class="pull-right">
          <a aria-label="Add Coupon Code" class="madero-link u_clickable" ng-click="addCoupon = true" tabindex="1">Add A Coupon Code</a>
        </span>
      </p>    
      <div class="row" ng-show="addCoupon">
        <div class="col-md-12">
          <div class="form-group">
            <label for="coupon-code" class="control-label">Coupon Code:</label>
            <span class="pull-right">
              <a aria-label="Cancel Coupon Code" class="madero-link u_clickable" ng-click="clearCouponCode()" tabindex="1">Cancel</a>
            </span>
            <div class="flex-row">
              <input id="coupon-code" aria-required="false" type="text" class="form-control mr-3" name="couponCode" ng-model="purchase.couponCode">
              <button id="apply-coupon-code" type="button" aria-label="Apply Coupon Code" class="btn btn-default" ng-click="applyCouponCode()">Apply</button>
            </div>
          </div>
        </div>
      </div>

      <div class="border-bottom pb-4">
        <p class="mb-0" ng-repeat="coupon in purchase.estimate.coupons">
          <span class="font-weight-bold">{{coupon.couponName}}:</span>
          <span class="pull-right">-${{coupon.couponAmount | number:2}}</span>
        </p>
        <p class="mb-0" ng-repeat="tax in purchase.estimate.taxes">
          <span>{{tax.taxName}}:</span>
          <span class="pull-right">${{tax.taxAmount | number:2}}</span>
        </p>
        <p class="mb-0">
          <span class="font-weight-bold">Total tax:</span>
          <span class="pull-right">${{purchase.estimate.totalTax | number:2}}</span>
        </p>
      </div>

      <div class="py-4">
        <p class="mb-0">
          <span class="font-weight-bold">Prorated amount, due now:</span>
          <span class="pull-right"><span class="u_margin-right text-subtle">{{factory.estimate.invoice_estimate.currency_code}}</span><span class="purchase-total">${{factory.estimate.invoice_estimate.amount_due/100 | number:2}}</span></span>
        </p>
        <p class="mb-0">
          <span class="font-weight-bold">Nex invoice on {{factory.estimate.subscription_estimate.next_billing_at * 1000 | date:'d-MMM-yyyy'}}:</span>
          <span class="pull-right"><span class="u_margin-right text-subtle">{{factory.estimate.next_invoice_estimate.currency_code}}</span><span class="purchase-total">${{factory.estimate.next_invoice_estimate.amount_due/100 | number:2}}</span></span>
        </p>
      </div>
    </div>

    <div class="button-row text-right mt-5">
      <button id="backButton" type="button" aria-label="Go back to Billing Address" class="btn btn-default btn-toolbar pull-left" ng-click="setPreviousStep()" translate>common.cancel</button>
      <button id="payButton" type="submit" class="btn btn-primary btn-toolbar-wide" form="form.paymentMethodsForm" ng-click="completeCardPayment()" tabindex="1" aria-label="Complete Payment" ng-if="paymentMethods.paymentMethod === 'card'">
        <span id="payLabel">Pay ${{purchase.estimate.total | number:2}} Now</span>
      </button>
      <button id="invoiceButton" type="submit" class="btn btn-primary btn-toolbar-wide" form="form.paymentMethodsForm" ng-click="completePayment()" tabindex="1" aria-label="Complete Payment" ng-if="paymentMethods.paymentMethod === 'invoice'">
        <span id="invoiceLabel">Invoice Me ${{purchase.estimate.total | number:2}} Now</span>
      </button>
    </div>

  </div>
  <checkout-success ng-show="currentStep === 3"></checkout-success>

  <div class="mt-5 border-top" ng-include="'partials/purchase/purchase-footer.html'"></div>

</div>
