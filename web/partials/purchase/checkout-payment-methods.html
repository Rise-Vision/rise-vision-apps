<!-- Step 4 -->
<div class="purchase-sideways-panels">
  <div id="checkout-payment-methods">
    <h4 class="u_margin-md-bottom">Payment Method</h4>

    <form id="form.paymentMethodsForm" role="form" name="form.paymentMethodsForm" novalidate>
      <div class="flex-row mb-4" ng-show="!purchase.plan.isMonthly">
        <div id="payment-method-select" class="btn-group btn-group-justified" ng-click="paymentMethods.paymentMethod = (paymentMethods.paymentMethod === 'card' ? 'invoice' : 'card')">
          <button type="button" class="btn"
            ng-class="{'btn-toggle-blue-off' : paymentMethods.paymentMethod !== 'card', 'btn-toggle-blue-on' : paymentMethods.paymentMethod === 'card'}">
            Pay With Credit Card
            <streamline-icon name="checkmark" ng-show="paymentMethods.paymentMethod === 'card'"></streamline-icon>
          </button>
          <button type="button" class="btn"
            ng-class="{'btn-toggle-blue-off' : paymentMethods.paymentMethod !== 'invoice', 'btn-toggle-blue-on' : paymentMethods.paymentMethod === 'invoice'}">
            Invoice Me
            <streamline-icon name="checkmark" ng-show="paymentMethods.paymentMethod === 'invoice'"></streamline-icon>
          </button>
        </div>
      </div>

      <credit-card-form form-object="form.paymentMethodsForm" payment-methods-object="paymentMethods" ng-show="paymentMethods.paymentMethod === 'card'"></credit-card-form>

      <!-- //GENERATE INVOICE FORM -->
      <div id="generateInvoice" ng-show="paymentMethods.paymentMethod === 'invoice'">
        <p>Please enter a purchase order number if applicable. Your invoice will be sent to 
          <b>{{contactEmail}}</b> with net 30 day terms. Invoice is payable by check, wire transfer, or credit card.</p>

        <div class="row">
          <div class="col-xs-12">
            <div class="form-group">
              <label for="invoice-po-number" class="control-label">
                Purchase Order Number (optional):
              </label>
              <input id="invoice-po-number" type="text" class="form-control" name="purchaseOrder" ng-model="paymentMethods.purchaseOrderNumber" />
            </div>
          </div>
        </div>

        <div id="generateInvoiceOverdue" class="hidden">
          <p class="text-danger">You have overdue invoice payments on your account.</p>
          <p>In order to complete this purchase by invoice, please pay your outstanding invoices <a href="#">here</a>.</p>
        </div>
      </div>

      <div id="errorBox" class="madero-style alert alert-danger u_margin-md-top" role="alert" ng-show="paymentMethods.newCreditCard.validationErrors.length">
        <strong>Card Validation Error<span ng-show="paymentMethods.newCreditCard.validationErrors.length > 1">s</span></strong>
        <ul>
          <li ng-repeat="error in paymentMethods.newCreditCard.validationErrors">{{error}}</li>
        </ul>
      </div>

    </form>

  </div>
  <purchase-summary id="checkout-purchase-summary" ng-if="currentStep === 2"></purchase-summary>
</div>

<div id="errorBox" class="madero-style alert alert-danger u_margin-md-top" role="alert" ng-show="paymentMethods.tokenError">
  <strong>Card Processing Error</strong> {{paymentMethods.tokenError}}
</div>

<div id="errorBox" class="madero-style alert alert-danger u_margin-md-top" role="alert" ng-show="purchase.checkoutError">
  <strong>Payment Error</strong> {{purchase.checkoutError}}
</div>

<div class="button-row text-right mt-5">
  <button id="backButton" type="button" aria-label="Go back to Billing Address" class="btn btn-default btn-toolbar pull-left" ng-click="setPreviousStep()" translate>common.back</button>
  <button id="payButton" type="submit" class="btn btn-primary btn-toolbar-wide" form="form.paymentMethodsForm" ng-click="completeCardPayment(creditCardFactory.stripeElements.cardNumber)" tabindex="1" aria-label="Complete Payment" ng-if="purchase.paymentMethods.paymentMethod === 'card'">
    <span id="payLabel">Pay ${{purchase.estimate.total | number:2}} Now</span>
  </button>
  <button id="invoiceButton" type="submit" class="btn btn-primary btn-toolbar-wide" form="form.paymentMethodsForm" ng-click="completePayment()" tabindex="1" aria-label="Complete Payment" ng-if="purchase.paymentMethods.paymentMethod === 'invoice'">
    <span id="invoiceLabel">Invoice Me ${{purchase.estimate.total | number:2}} Now</span>
  </button>
</div>
