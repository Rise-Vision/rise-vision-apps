<div class="madero-style">
  <div class="app-header u_padding-20-vertical mb-5 border-bottom">
    <h1 class="app-header-title">Remove Display Licenses</h1>
  </div>

  <div rv-spinner rv-spinner-key="purchase-licenses-loader" rv-spinner-start-active="1"></div>

  <div ng-show="factory.apiError" class="madero-style alert alert-danger text-center u_margin-md-top" role="alert">
    <p><strong>{{factory.errorMessage}}</strong></p>
    {{factory.apiError}}
  </div>

  <div class="purchase-licenses-centered-panel" ng-hide="factory.purchase.completed">
    <form role="form" name="purchaseLicensesForm" ng-submit="completePayment()">
      <div class="checkout-gray-panel">
        <h4 class="u_margin-md-bottom mt-0 mb-4">Subscription Details</h4>

        <div class="left-right-aligner" ng-class="{'has-error': purchaseLicensesForm.$invalid }">
          <label for="displayCount" class="control-label">Number of display licenses you want to remove:</label>
          <input class="display-count-input mt-0 pull-right" type="number" name="displayCount" ng-model="factory.purchase.displayCount" min="1" max="{{currentPlan.playerProTotalLicenseCount-1}}" ng-pattern="/^[0-9]+$/" required ng-change="getEstimate()" ng-model-options="{ debounce: 1000 }" autofocus />
        </div>

        <div class="border-bottom py-4 mb-4">
          <p class="left-right-aligner mb-0">
            <span class="font-weight-bold">Total number of display licenses for this subscription:</span>
            <span>
              {{currentPlan.playerProTotalLicenseCount - factory.purchase.displayCount}}
            </span>
          </p>
        </div>

        <div class="pt-4">
          <p id="prorated-amount-row" class="left-right-aligner mb-4" ng-if="factory.estimate.invoice_estimate">
            <span class="font-weight-bold">Generated invoice:</span>
            <span>
              <span class="u_margin-right text-subtle">{{factory.estimate.invoice_estimate.currency_code}}</span>
              <span class="purchase-total">${{factory.estimate.invoice_estimate.total/100 | number:2}}</span>
            </span>
          </p>
          <p id="prorated-credit-row" class="left-right-aligner mb-4">
            <span class="font-weight-bold">Prorated credit added to your account:</span>
            <span>
              <span class="u_margin-right text-subtle">{{factory.estimate.credit_note_estimates[0].currency_code}}</span>
              <span class="purchase-total">${{factory.getCreditTotal() | number:2}}</span>
            </span>
          </p>
          <p id="next-invoice-row" class="left-right-aligner mb-0">
            <span class="font-weight-bold">Next invoice on {{factory.estimate.subscription_estimate.next_billing_at * 1000 | date:'d-MMM-yyyy'}}:</span>
            <span>
              <span class="u_margin-right text-subtle">{{factory.estimate.next_invoice_estimate.currency_code}}</span>
              <span class="purchase-total">${{factory.estimate.next_invoice_estimate.total/100 | number:2}}</span>
            </span>
          </p>
        </div>
      </div>

      <div class="flex-row u_margin-md-top mb-5">
        <button id="backButton" type="button" aria-label="Go back" class="btn btn-default btn-toolbar pull-left" ng-click="close()" translate>common.cancel</button>
        <button id="payButton" type="submit" class="btn btn-primary ml-4 w-100" tabindex="1" aria-label="Update Subscription" ng-disabled="purchaseLicensesForm.$invalid" >
          <span id="invoiceLabel">Update Subscription</span>
        </button>
      </div>
    </form>
  </div>

  <div class="mt-5 border-top">
    <purchase-footer></purchase-footer>
  </div>

</div>
