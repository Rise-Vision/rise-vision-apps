'use strict';

angular.module('risevision.editor.services')
  .constant('TEMPLATES_TYPE', 'Templates')
  .constant('UNLISTED_STORE_PRODUCTS', [{
    'productId': '288',
    'productOrderWeight': 17,
    'name': 'Embedded Presentation',
    'descriptionShort': 'Get Embedded Presentations as part of our Enterprise Plan',
    'descriptionLong': '<br>\n<br>\n<a href=\'https://store.risevision.com/product/301/enterprise-plan\'>Get Embedded Presentations as part of our Enterprise Plan</a>',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Rise-Vision/embedded-presentations-1280x960.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Rise-Vision/embedded-presentations-640x480.jpg',
    'paymentTerms': 'Subscription',
    'trialPeriod': 14,
    'productCode': 'd3a418f1a3acaed42cf452fefb1eaed198a1c620'
  }, {
    'productId': '54',
    'productOrderWeight': 0,
    'name': 'Weather Forecast and Conditions',
    'descriptionShort': 'Current Conditions and 3 Day Forecast from around the world.',
    'descriptionLong': 'Choose to display weather by postal code or geolocation, including current conditions and three day forecast, or each one independently.\n<br>\n<br>\nData sets include high and low temperatures, wind, humidity and sky.<br>\n<br>\nCombine with <a href=\'https://store.risevision.com/product/110/weather-maps\' target=\'_blank\'>Weather Maps</a> to build a complete overview of the weather in any region of the United States! \n<br>\n<br>\n<b><a href=\'http://preview.risevision.com/Viewer.html?type=presentation&id=2709c248-1315-4bee-a8d6-0c65a1a0978c&showui=false\' target=\'_blank\'>Preview a sample presentation</a></b>\n\nto see how it looks or \n\n<b><a href=\'https://editor.risevision.com/#/editor/workspace/new/?copyOf=2709c248-1315-4bee-a8d6-0c65a1a0978c\' target=\'_blank\'> open in Rise Editor to start your trial period and use it.</a></b>',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Digichief/widget_1001_1080.jpg'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Digichief/widget_1001_image_edit3.jpg',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '8caa38db59680581c9a5ce84c90e3edc438511cc',
  }, {
    'productId': '145',
    'productOrderWeight': 1,
    'name': 'Mostly Sunny!',
    'descriptionShort': 'Display weather from around the world in a simple, minimalist style.',
    'descriptionLong': 'Mostly Sunny! delivers weather conditions for anywhere in the world in a simple, minimalist style. \n<br>\n<br>\nWith a responsive layout and support for 15 languages its a perfect fit for any display.',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_MostlySunny_image.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_MostlySunny_image.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': 'ba877a971c4bdb8747a538d84846d22faebf5577',
  }, {
    'productId': '281',
    'productOrderWeight': 2,
    'name': 'Ticky',
    'descriptionShort': 'Ticky makes it simple to add scrolling tickers to your presentations.',
    'descriptionLong': 'Ticky makes adding a scrolling ticker to your presentation easier than ever! Ticky is super customizable, making it easy to fit into any presentation. Add your messages to a simple list and choose your font, colors, and scrolling speed. Ticky takes care of the rest!',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_ticky_image.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_ticky_image.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '864967bf8e397131d41913bc3c9a508fe8e325c2',
  }, {
    'productId': '110',
    'productOrderWeight': 3,
    'name': 'Weather Maps',
    'descriptionShort': 'Regional weather maps for the contiguous United States.',
    'descriptionLong': 'Choose to display Regional or US based Weather Maps, including: Radar, Satellite and a color fill-in representation of Watches, Warnings and Advisories.\n<br>\n<br>\nCombine with <a href=\'https://store.risevision.com/product/54/weather-forecast-and-conditions\' target=\'_blank\'>Weather Forecast and Conditions</a> to build a complete overview of the weather in any region of the United States!\n<br>\n<br>\n<b><a href=\'http://preview.risevision.com/Viewer.html?type=presentation&id=9ea545d6-9734-4595-940e-f4e8a938a222&showui=false\' target=\'_blank\'>Preview a sample presentation</a></b>\n\nto see how it looks or \n\n<b><a href=\'https://editor.risevision.com/#/editor/workspace/new/?copyOf=9ea545d6-9734-4595-940e-f4e8a938a222\' target=\'_blank\'> open in Rise Editor to start your trial period and use it.</a></b>',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Digichief/widget_4000_image_radar1080.jpg',
      'https://s3.amazonaws.com/Store-Products/Digichief/widget_4000_image_Watches_and_Warnings1080.jpg',
      'https://s3.amazonaws.com/Store-Products/Digichief/widget_4000_image_satellite1080.jpg'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Digichief/widget_4000_image_edit3.jpg',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': 'cb04f6218749afd0a7d350f0418ab2d52b58b135'
  }, {
    'productId': '55',
    'productOrderWeight': 4,
    'name': 'News Headlines',
    'descriptionShort': 'News Headlines and Images from The Associated Press.',
    'descriptionLong': 'Show exactly the news you want in your Presentation!\n<br>\n<br>\nIncludes multiple categories of headlines news with images, such as: US News, International, Business, Entertainment, Health, Political, Science, Sports, Technology, and more.\n<br>\n<br>\n<b><a href=\'http://preview.risevision.com/Viewer.html?type=presentation&id=c9e8a445-f97a-4504-9ab7-09b890586393&showui=false\' target=\'_blank\'>Preview a sample presentation</a></b>\n\nto see how it looks or \n\n<b><a href=\'https://editor.risevision.com/#/editor/workspace/new/?copyOf=c9e8a445-f97a-4504-9ab7-09b890586393\' target=\'_blank\'> open in Rise Editor to start your trial period and use it.</a></b>',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Digichief/widget_2000_1080.jpg'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Digichief/widget_2000_image_edit3.jpg',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '4cfbbc9506cbc248d60aced179ca298a0427e306',
  }, {
    'productId': '111',
    'productOrderWeight': 5,
    'name': 'U.S. Stocks - Streaming Watchlist',
    'descriptionShort': 'Create a streaming watchlist of up to 30 U.S. equities.',
    'descriptionLong': 'Create your own list of U.S. stocks and make your display come to life with this streaming (flashing red and green as prices change during market hours) list of U.S. equities. Logos included! Or use our pre-built list featuring the Dow Jones Industrial Average.\n<br>\n<br>\nFinancial data is 15 minutes delayed and is provided by Xignite.\n<br>\n<br>\n<b><a href=\'http://preview.risevision.com/Viewer.html?type=presentation&id=b22bc4ad-4cfd-4de4-b86b-b3b5b6be1539&showui=false\' target=\'_blank\'>Preview a sample presentation</a></b>\n\nto see how it looks or \n\n<b><a href=\'https://editor.risevision.com/#/editor/workspace/new/?copyOf=b22bc4ad-4cfd-4de4-b86b-b3b5b6be1539\' target=\'_blank\'> open in Rise Editor to start your trial period and use it.</a></b>',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/StockTrak/stocktrak-screenshot-dark.jpg',
      'https://s3.amazonaws.com/Store-Products/StockTrak/stocktrak-screenshot-light.jpg'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/StockTrak/widget_918_image_edit1.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '7949cc2b1ab2b77f2ce48d23c5aae55b9d4d27d6',
  }, {
    'productId': '56',
    'productOrderWeight': 6,
    'name': 'Sports Scores',
    'descriptionShort': 'Scores for Pro and Collegiate Sports.',
    'descriptionLong': 'Choose to display top college and professional sports scores, including NFL, NBA, MLB, NCAA Football, and more.\n<br>\n<br>\n<b><a href=\'http://preview.risevision.com/Viewer.html?type=presentation&id=6418b703-c166-4493-831c-54ee80691389&showui=false\' target=\'_blank\'>Preview a sample presentation</a></b>\n\nto see how it looks or \n\n<b><a href=\'https://editor.risevision.com/#/editor/workspace/new/?copyOf=6418b703-c166-4493-831c-54ee80691389\' target=\'_blank\'> open in Rise Editor to start your trial period and use it.</a></b>',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Digichief/widget_3000_1080.jpg'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Digichief/widget_3000_image_edit3.jpg',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '6051f3bd130d00f359a54a3015d233edecb8af20',
  }, {
    'productId': '108',
    'productOrderWeight': 7,
    'name': 'Photo Feed Widget',
    'descriptionShort': 'Easily stream photos from Instagram or Google Photos in your Presentations.',
    'descriptionLong': 'PhotoFeed is the perfect Widget to quickly and easily sync images from your Instagram and Google Photos accounts with your digital signage Presentations.\n<br>\n<br>\nBuilt to blend seamlessly into your Presentation, PhotoFeed allows you to manage your images right from your Social Media accounts. Add and remove images, and the PhotoFeed Widget will automatically update in your Presentation; there\'s no need to log into the Rise Vision Platform to update your Presentation directly. \n<br>\n<br>\nStart using the PhotoFeed Widget today!',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_ciaphotofeed_image.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_ciaphotofeed_image.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': 'b173d97f016a40660149b2f12ebf88021118a83d',
  }, {
    'productId': '81',
    'productOrderWeight': 8,
    'name': 'YouTube Widget',
    'descriptionShort': 'This Widget plays YouTube videos on Windows, Linux, and Android.',
    'descriptionLong': 'The YouTube Widget provides the ability to add shared videos and playlist videos to your digital signage. It works with the Rise Vision Chrome App Player on all operating systems, My Rise Player on Android 4.4 and above, My Rise Player Test with Android 4.2 and above, Amazon Fire TV with My Rise Player, and Android TV with My Rise Player.',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Scotts-Digital-Signage/YouTube.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Scotts-Digital-Signage/YouTube.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '331c8dbba05c262590d3b00c533a9e7cbe50ad5a',
  }, {
    'productId': '93',
    'productOrderWeight': 9,
    'name': 'Vimeo HTML5 Widget',
    'descriptionShort': 'The Vimeo HTML5 Widget is your go to Widget for Vimeo video streaming.',
    'descriptionLong': 'The Vimeo HTML5 Widget is what to use if you\'re using Vimeo for video streaming. It uses the standard HTML5 Video format so you can put it on any device, including devices that don\'t run Adobe Flash. Have fun and enjoy what the Vimeo Widget has to offer!',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Scotts-Digital-Signage/vimeo.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Scotts-Digital-Signage/vimeo.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': 'd377232f9cff6622000511fa081558790c515bc3',
  }, {
    'productId': '95',
    'productOrderWeight': 10,
    'name': 'ComputerAid Countdown Widget',
    'descriptionShort': 'A customizable countdown timer for upcoming events.',
    'descriptionLong': 'The Countdown Widget is the perfect way to highlight upcoming holidays or mark any important event!\n<br>\n<br>\nEasy to use and highly customizable, the Countdown Widget fits seamlessly into any Rise Vision presentation.',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_caicountdown_image.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_caicountdown_image.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': 'b9c1d88d34b8f930005602a4046efc99c53e3349',
  }, {
    'productId': '96',
    'productOrderWeight': 11,
    'name': 'ComputerAid CountUp Widget',
    'descriptionShort': 'Count up from key milestones with this customizable timer.',
    'descriptionLong': 'The CountUp Widget is the perfect way to mark the time that\'s passed since a key milestone or date (i.e. \'Days since last accident\').\n<br>\n<br>\nCountUp is easy to use and highly customizable, fitting seamlessly into any Rise Vision presentation.',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_caicountup_image.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/Computer-Aid/widget_caicountup_image.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '2a352191d1c6c834af2c939ee9a3d8dc826565ba',
  }, {
    'productId': '99',
    'productOrderWeight': 14,
    'name': 'Flight Monitor Arrivals Widget',
    'descriptionShort': 'Show arrivals for a single airport.',
    'descriptionLong': 'Use this Widget to display arrival flights for an airport of your choosing.\n<br>\n<br>\nCustomize all elements of the Widget so it fits perfectly into your Presentation! Interested in showing Departures as well? Be sure to check out the <a href=\'https://store.risevision.com/product/112/flight-board-widget-departures\' target=\'_blank\'> Flight Monitor Departures Widget</a>.',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/FlightTime-TV/arrivals_image_edit2.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/FlightTime-TV/arrivals_image_edit2.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '1e700e73766af2b16d21397527c9f8fa3b8a925e',
  }, {
    'productId': '112',
    'productOrderWeight': 15,
    'name': 'Flight Monitor Departures Widget',
    'descriptionShort': 'Show departures for a single airport.',
    'descriptionLong': 'Use this Widget to display departure flights for an airport of your choosing.\n<br>\n<br>\nCustomize all elements of the Widget so it fits perfectly into your Presentation! Interested in showing Arrivals as well? Be sure to check out the <a href=\'https://store.risevision.com/product/99/flight-board-widget-arrivals\' target=\'_blank\'> Flight Monitor Arrivals Widget</a>.',
    'detailImageUrls': [
      'https://s3.amazonaws.com/Store-Products/FlightTime-TV/departures_image_edit2.png'
    ],
    'imageUrl': 'https://s3.amazonaws.com/Store-Products/FlightTime-TV/departures_image_edit2.png',
    'paymentTerms': 'Subscription',
    'trialPeriod': 7,
    'productCode': '112a9b3f5dfc0cc743ccefa85072a41bc594170e',
  }])
  .factory('productsFactory', ['$q', '$filter', 'store', 'subscriptionStatusFactory', 'TEMPLATES_TYPE',
    'UNLISTED_STORE_PRODUCTS',
    function ($q, $filter, store, subscriptionStatusFactory, TEMPLATES_TYPE, UNLISTED_STORE_PRODUCTS) {
      var factory = {};

      factory.isUnlistedProduct = function (productCode) {
        return !!_.find(UNLISTED_STORE_PRODUCTS, {
          productCode: productCode
        });
      };

      var _getUnlistedProducts = function () {
        var productCodes = _.map(UNLISTED_STORE_PRODUCTS, 'productCode');

        return subscriptionStatusFactory.checkProductCodes(productCodes)
          .then(function (statusItems) {
            return _.filter(UNLISTED_STORE_PRODUCTS, function (product) {
              var statusItem = _.find(statusItems, {
                pc: product.productCode
              });
              return !statusItem || statusItem.isSubscribed;
            });
          });
      };

      factory.loadProducts = function (search, cursor) {
        var unlistedProducts = [];
        if (search && search.category !== TEMPLATES_TYPE) {
          unlistedProducts = _getUnlistedProducts();
        }

        return $q.all([store.product.list(search, cursor), unlistedProducts])
          .then(function (results) {
            var filteredUnlistedProducts = search ? $filter('filter')(results[1], search.query) : results[1];

            _.each(filteredUnlistedProducts, function (product) {
              if (!results[0].items) {
                results[0].items = [product];
              } else if (results[0].items.length > product.productOrderWeight) {
                results[0].items.splice(product.productOrderWeight, 0, product);
              } else {
                results[0].items.push(product);
              }
            });

            return results[0];
          });
      };

      return factory;
    }
  ]);
